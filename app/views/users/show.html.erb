<% content_for :title, @user.username %>

<!-- Modern Profile Page -->
<div class="modern-page-container">
  <!-- Profile Header -->
  <div class="profile-header-modern">
    <div class="profile-header-modern__cover"></div>
    <div class="profile-header-modern__content">
      <!-- Avatar -->
      <div class="profile-avatar-modern">
        <% if @user.avatar.attached? %>
          <% begin %>
            <%= image_tag url_for(@user.avatar.variant(resize_to_fill: [120,120])), 
                class: "profile-avatar-modern__image" %>
          <% rescue ActiveStorage::FileNotFoundError %>
            <div class="profile-avatar-modern__fallback">
              <%= @user.username&.first&.upcase || 'U' %>
            </div>
          <% end %>
        <% else %>
          <div class="profile-avatar-modern__fallback">
            <%= @user.username&.first&.upcase || 'U' %>
          </div>
        <% end %>
      </div>

      <!-- User Info -->
      <div class="profile-info-modern">
        <h1 class="profile-username-modern"><%= @user.username %></h1>
        <div class="profile-stats-modern">
          <div class="profile-stat">
            <span class="profile-stat__value"><%= @recipes.count %></span>
            <span class="profile-stat__label"><%= t('users.recipes', default: 'Rețete') %></span>
          </div>
          <div class="profile-stat">
            <span class="profile-stat__value"><%= @user.followers.count %></span>
            <span class="profile-stat__label"><%= t('follows.followers', default: 'Urmăritori') %></span>
          </div>
          <div class="profile-stat">
            <span class="profile-stat__value"><%= @user.following.count %></span>
            <span class="profile-stat__label"><%= t('follows.following', default: 'Urmărește') %></span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="profile-actions-modern">
        <% if user_signed_in? && current_user == @user %>
          <%= link_to edit_user_registration_path(locale: I18n.locale), class: "modern-btn-secondary" do %>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
            <span><%= t('users.edit_profile', default: 'Editează Profil') %></span>
          <% end %>
        <% elsif user_signed_in? %>
          <div id="follow-button-<%= @user.id %>">
            <%= render 'follows/button', user: @user %>
          </div>
          <%= button_to conversations_path(recipient_id: @user.id, locale: I18n.locale), method: :post, 
              class: "modern-btn-secondary" do %>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
            <span><%= t('conversations.message', default: 'Mesaj') %></span>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Collections Section -->
  <% if @collections.any? %>
    <div class="profile-section-modern">
      <h2 class="profile-section-title">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
        </svg>
        <%= t('collections.title', default: 'Colecții') %> (<%= @collections.count %>)
      </h2>
      <div class="modern-grid">
        <% @collections.each_with_index do |collection, index| %>
          <div class="modern-card" style="animation-delay: <%= index * 0.08 %>s">
            <%= link_to collection_path(collection, locale: I18n.locale), class: "block" do %>
              <div class="modern-card__header">
                <div class="modern-card__icon modern-card__icon--purple">
                  <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                  </svg>
                </div>
                <h3 class="modern-card__title"><%= collection.name %></h3>
              </div>
              <div class="modern-card__stats">
                <span class="modern-stat-badge modern-stat-badge--purple">
                  <%= collection.recipes.count %> <%= t('recipes.title', default: 'rețete') %>
                </span>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Recipes Section -->
  <div class="profile-section-modern">
    <div class="flex items-center justify-between mb-6">
      <h2 class="profile-section-title">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/>
        </svg>
        <%= t('users.recipes', default: 'Rețete') %> (<%= @recipes.count %>)
      </h2>
      <% if user_signed_in? && current_user == @user %>
        <%= link_to new_recipe_path(locale: I18n.locale), class: "modern-btn-primary" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          <span><%= t('recipes.new', default: 'Rețetă Nouă') %></span>
        <% end %>
      <% end %>
    </div>

    <% if @recipes.any? %>
      <div class="recipe-feed-grid">
        <% @recipes.each_with_index do |recipe, index| %>
          <div class="recipe-card-wrapper" style="animation-delay: <%= index * 0.08 %>s">
            <%= render "recipes/card_minimal", recipe: recipe %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="modern-empty-state">
        <div class="modern-empty-icon">
          <svg class="w-20 h-20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/>
          </svg>
        </div>
        <h3 class="modern-empty-title">
          <% if user_signed_in? && current_user == @user %>
            <%= t('users.no_recipes_yet', default: 'Nu ai publicat rețete încă') %>
          <% else %>
            <%= t('users.no_recipes_published', default: 'Nu are rețete publicate') %>
          <% end %>
        </h3>
        <% if user_signed_in? && current_user == @user %>
          <p class="modern-empty-description"><%= t('users.start_sharing', default: 'Începe să partajezi rețetele tale!') %></p>
          <%= link_to new_recipe_path(locale: I18n.locale), class: "modern-btn-primary mt-6" do %>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            <span><%= t('users.publish_first', default: 'Publică Prima Rețetă') %></span>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
